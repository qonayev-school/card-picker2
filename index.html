<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Мемды қайтала</title>
  <style>
    :root{
      --bg:#0f1724;
      --card-bg:linear-gradient(180deg,#ffffff,#f8fafc);
      --accent:#ffd166;
      --card-w:150px;
      --card-h:200px;
      --gap:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family:Inter, system-ui, Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(255,209,102,0.06), transparent),
                  radial-gradient(1000px 500px at 90% 90%, rgba(99,102,241,0.04), transparent),
                  var(--bg);
      color:#e6eef8;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:36px;
    }
    .board{
      width:min(1100px,100%);
      background:rgba(255,255,255,0.04);
      border-radius:16px;
      padding:24px;
      box-shadow:0 6px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    }
    .header{
      display:flex;align-items:center;gap:12px;margin-bottom:14px
    }
    .title{font-size:20px;color:#fff;margin:0}
    .subtitle{color:#cbd5e1;font-size:13px}
    .cards-container{
      display:flex;flex-wrap:wrap;gap:var(--gap);justify-content:center;
      perspective:1200px;
    }
    .card{
      width:var(--card-w);height:var(--card-h);
      border-radius:12px;
      background:#f9ae54;
      border:2px solid rgba(255,209,102,0.12);
      box-shadow: 0 8px 18px rgba(2,6,23,0.6);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;position:relative;overflow:hidden;
      transform-style:preserve-3d;transition:transform .45s cubic-bezier(.2,.9,.3,1),opacity .35s ease;
    }
    .card img{width:0%;height:0%;object-fit:cover;display:block;backface-visibility:hidden}
    .card.flip{transform:rotateY(180deg) scale(1.02)}
    .card.hide{opacity:0;transform:scale(.92)}

    /* small label */
    .label{
      position:absolute;left:8px;top:8px;background:rgba(0,0,0,0.35);padding:6px 8px;border-radius:8px;font-size:12px;color:#fff
    }

    /* fullscreen viewer */
    #fullscreen{
      display:none;position:fixed;inset:0;z-index:1200;align-items:center;justify-content:center;background:rgba(2,6,23,0.8);
      animation:fadeIn .18s ease both;
    }
    #fullscreen img{max-width:92%;max-height:92%;border-radius:12px;box-shadow:0 30px 60px rgba(2,6,23,0.6)}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}

    /* responsive */
    @media (max-width:600px){:root{--card-w:120px;--card-h:160px;--gap:12px}}
  </style>
</head>
<body>
  <div class="board">
    <div class="header">
      <div>
        <h1 class="title">Карточканы таңдаңыз</h1>
        <div class="subtitle">Мемды қайталап көріңіз!</div>
      </div>
    </div>

    <div class="cards-container" id="cards"></div>
  </div>

  <!-- fullscreen viewer -->
  <div id="fullscreen" role="dialog" aria-hidden="true">
    <img id="fullImg" alt="Полноэкранное изображение" src=""/>
  </div>

  <script>
    // Данные — добавлены дополнительные карточки как простые "тесты" поведения
    const cards = [
      { id: 1, img: 'Рисунок1.jpg', label: 'Вариант 1' },
      { id: 2, img: 'Рисунок2.jpg', label: 'Вариант 2' },
      { id: 3, img: 'Рисунок3.jpg', label: 'Вариант 3' },
      { id: 4, img: 'Рисунок4.jpg', label: 'Вариант 4' },
      { id: 5, img: 'Рисунок5.jpg', label: 'Вариант 5' },
      { id: 6, img: 'Рисунок6.jpg', label: 'Вариант 6' },
      { id: 7, img: 'Рисунок7.jpg', label: 'Вариант 7' },
      { id: 8, img: 'Рисунок8.jpg', label: 'Вариант 8' },
      { id: 9, img: 'Рисунок9.jpg', label: 'Вариант 9' },
      { id: 10, img: 'Рисунок10.jpg', label: 'Вариант 10' },
      { id: 11, img: 'Рисунок11.jpg', label: 'Вариант 11' },
      { id: 12, img: 'Рисунок12.jpg', label: 'Вариант 12' },
      { id: 13, img: 'Рисунок13.jpg', label: 'Вариант 13' },
      { id: 14, img: 'Рисунок14.jpg', label: 'Вариант 14' },
      { id: 15, img: 'Рисунок15.jpg', label: 'Вариант 15' },
    ];

    // Звуки (щелчок и магический открывающий звук)
    const SOUNDS = {
      click: 'https://www.soundjay.com/button/sounds/button-3.mp3',
      open:  'https://www.soundjay.com/misc/sounds/magic-chime-01.mp3'
    };

    // Безопасный проигрыш звука — игнорируем ошибки автоплея
    function playSound(url){
      try{
        const a = new Audio(url);
        a.play().catch(()=>{});
      }catch(e){console.warn('sound failed',e)}
    }

    // Рендер карточек
    function renderCards(){
      const container = document.getElementById('cards');
      container.innerHTML = '';
      cards.forEach(card => {
        if (card.removed) return;
        const el = document.createElement('div');
        el.className = 'card';
        el.dataset.id = card.id;

        // Lock to prevent double clicks
        el.dataset.locked = 'false';

        const img = document.createElement('img');
        img.src = card.img;
        img.alt = card.label || `card-${card.id}`;

        const label = document.createElement('div');
        label.className = 'label';
        label.textContent = card.label || '';

        el.appendChild(img);
        el.appendChild(label);

        el.addEventListener('click', () => {
          if (el.dataset.locked === 'true') return;
          el.dataset.locked = 'true';
          flipCard(el, card.id, card.img);
        });

        container.appendChild(el);
      });
    }

    // Показ полноэкранного изображения. Возвращает объект с методом close()
    function showFullScreen(imgSrc){
      const full = document.getElementById('fullscreen');
      const fullImg = document.getElementById('fullImg');
      fullImg.src = imgSrc;
      full.style.display = 'flex';
      full.setAttribute('aria-hidden','false');

      // Клик по затемнённому фону / картинке закроет
      const onClose = () => {
        full.style.display = 'none';
        full.removeEventListener('click', onClose);
      };
      full.addEventListener('click', onClose);

      return { close: onClose };
    }

    // Логика переворота -> звук -> полноэкран -> исчезновение -> удаление
    function flipCard(element, id, imgSrc){
      // анимация переворота
      element.classList.add('flip');
      playSound(SOUNDS.click);

      // после переворота показываем полноэкран
      setTimeout(()=>{
        playSound(SOUNDS.open);
        const viewer = showFullScreen(imgSrc);

        // Автоматически закроем просмотр через 1.4s (пользователь может кликнуть раньше)
        const autoClose = setTimeout(()=>{
          viewer.close();
        }, 1000400);

        // После закрытия — запустить плавное исчезновение и удалить карточку
        const cleanup = () => {
          clearTimeout(autoClose);
          // fade out
          element.classList.add('hide');
          setTimeout(()=> removeCard(id), 450);
        };

        // Привяжем одноразовое событие: если пользователь кликнул на полноэкран — сначала закроет, затем cleanup
        const full = document.getElementById('fullscreen');
        const onceHandler = () => {
          // убедимся, что close уже выполнился
          setTimeout(cleanup, 80);
          full.removeEventListener('click', onceHandler);
        };
        full.addEventListener('click', onceHandler);

        // Если пользователь не кликнул, autoClose сработает и мы всё равно удалим карточку
        setTimeout(()=>{
          // проверим, если элемент всё ещё видим и не скрыт — выполнить cleanup
          if (!element.classList.contains('hide')) cleanup();
        }, 1700);

      }, 480); // время переворота
    }

    function removeCard(id){
      const c = cards.find(x=>x.id===id);
      if (c) c.removed = true;
      renderCards();
    }

    // initial render
    renderCards();
  </script>
</body>
</html>
